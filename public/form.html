<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reservar cita</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    :root {
      --primary: #4c2882;
      --primary-dark: #3a2069;
      --bg: linear-gradient(135deg, #050507, #0a0a0f);
      --text: #f5f5f5;
      --text-secondary: #a0a0a0;
      --radius: 20px;
      --glow: 0 0 30px rgba(76, 40, 130, 0.4);
      --glow-pulse: 0 0 40px rgba(76, 40, 130, 0.6);
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      padding: 1rem;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: var(--text);
      overflow-x: hidden;
      position: relative;
    }
    /* Part√≠culas de fondo para sorpresa (CSS puro) */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(2px 2px at 20px 30px, #4c2882, transparent),
        radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.1), transparent),
        radial-gradient(1px 1px at 90px 40px, #3a2069, transparent),
        radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.05), transparent);
      background-repeat: repeat;
      background-size: 200px 100px;
      animation: particles 20s linear infinite;
      opacity: 0.3;
      pointer-events: none;
    }
    @keyframes particles {
      from { transform: translateY(0px); }
      to { transform: translateY(-100px); }
    }
    @media (min-width: 640px) {
      body { padding: 2rem; }
    }
    @keyframes fadeSlideUp {
      0% { opacity: 0; transform: translateY(40px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes typewriter {
      0% { width: 0; }
      50% { width: 100%; }
      100% { width: 100%; }
    }
    @keyframes glowPulse {
      0%, 100% { text-shadow: var(--glow); }
      50% { text-shadow: var(--glow-pulse); }
    }
    .card {
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(25px);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), var(--glow);
      max-width: 480px;
      width: 100%;
      border: 1px solid rgba(255, 255, 255, 0.08);
      animation: fadeSlideUp 0.8s ease-out;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 16px 50px rgba(0, 0, 0, 0.6), 0 0 40px rgba(76, 40, 130, 0.5);
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark), var(--primary));
      border-radius: var(--radius) var(--radius) 0 0;
      animation: shimmer 3s ease-in-out infinite;
    }
    @keyframes shimmer {
      0%, 100% { background-position: -200% 0; }
      50% { background-position: 200% 0; }
    }
    @media (min-width: 640px) {
      .card { padding: 3rem; }
    }
    /* Header hero para que el nombre SOBRESALGA üî• */
    .header-hero {
      text-align: center;
      margin-bottom: 2.5rem;
      position: relative;
    }
    h2#negocio {
      margin: 0;
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #ffffff, #e0e0ff, var(--primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -1px;
      position: relative;
      display: inline-block;
      overflow: hidden;
      white-space: nowrap;
      animation: typewriter 2s steps(40) forwards, glowPulse 2s ease-in-out infinite alternate;
      text-shadow: var(--glow);
      border-radius: 12px;
      padding: 0.5rem 1rem;
    }
    h2#negocio::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      border-radius: 2px;
      animation: wave 2s ease-in-out infinite;
    }
    @keyframes wave {
      0%, 100% { transform: translateX(-50%) scaleX(0.8); opacity: 0.5; }
      50% { transform: translateX(-50%) scaleX(1.2); opacity: 1; }
    }
    @media (max-width: 480px) {
      h2#negocio { font-size: 1.5rem; }
      .header-hero { margin-bottom: 1.5rem; }
    }
    .form-group {
      position: relative;
      margin-bottom: 1.5rem;
    }
    .input-wrapper {
      position: relative; /* Wrapper para centrar √≠cono en el input */
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text);
      transition: color 0.3s ease;
    }
    .form-group:focus-within label {
      color: var(--primary);
    }
    .input-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      fill: var(--text-secondary);
      z-index: 1;
      transition: fill 0.3s ease;
    }
    .input-wrapper:focus-within .input-icon {
      fill: var(--primary);
    }
    input, select {
      width: 100%;
      padding: 0.875rem 1rem 0.875rem 2.5rem;
      font-size: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius);
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      outline: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    input:focus, select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(76, 40, 130, 0.2), var(--glow);
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-1px);
    }
    select option {
      background: #1a1a1a;
      color: var(--text);
      padding: 0.75rem;
    }
    input::placeholder {
      color: var(--text-secondary);
    }
    button {
      width: 100%;
      padding: 1.125rem;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: var(--radius);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      margin-top: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(76, 40, 130, 0.3);
      position: relative;
      overflow: hidden;
    }
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    button:hover::before {
      left: 100%;
    }
    button:active::before {
      left: 0;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(76, 40, 130, 0.4);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    #msg {
      margin-top: 1rem;
      font-size: 0.95rem;
      text-align: center;
      padding: 0.75rem;
      border-radius: var(--radius);
      transition: all 0.3s ease;
    }
    #msg.success {
      background: rgba(34, 197, 94, 0.2);
      color: #86efac;
      border: 1px solid rgba(34, 197, 94, 0.3);
      animation: pulse 1s ease-in-out;
    }
    #msg.error {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    #msg.loading {
      color: var(--text-secondary);
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    .footer {
      margin-top: 2rem;
      font-size: 0.85rem;
      text-align: center;
      color: var(--text-secondary);
      opacity: 0.8;
    }
    .footer a {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .footer a:hover {
      color: var(--primary-dark);
    }
    @media (max-width: 480px) {
      .card { padding: 1.25rem; }
      input, select, button { font-size: 0.95rem; padding: 0.75rem 1rem 0.75rem 2.25rem; }
      h2#negocio { font-size: 1.5rem; }
      .input-icon { width: 18px; height: 18px; left: 0.75rem; }
      .form-group { margin-bottom: 1.25rem; }
    }
    /* Flatpickr con tema pro */
    .flatpickr-calendar {
      background: rgba(30, 30, 30, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), var(--glow);
      border-radius: var(--radius);
      overflow: hidden;
      font-family: 'Inter', sans-serif;
    }
    .flatpickr-months {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 0.75rem;
    }
    .flatpickr-current-month {
      color: white;
      font-weight: 600;
    }
    .flatpickr-current-month .numInputWrapper input {
      color: white;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
    }
    .flatpickr-weekday {
      color: rgba(255, 255, 255, 0.8) !important;
      font-weight: 600;
      background: rgba(76, 40, 130, 0.3);
    }
    .flatpickr-day {
      color: var(--text);
      background: transparent;
      border-radius: 50%;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }
    .flatpickr-day:hover {
      background: rgba(76, 40, 130, 0.3);
      border-color: var(--primary);
      color: white;
      transform: scale(1.05);
    }
    .flatpickr-day.today {
      background: linear-gradient(135deg, #9400D3, #8B008B) !important;
      color: white !important;
      border-color: #9400D3;
    }
    .flatpickr-day.selected {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark)) !important;
      color: white !important;
      border-color: var(--primary);
      box-shadow: var(--glow);
    }
    .flatpickr-day.flatpickr-disabled,
    .flatpickr-day.disabled,
    .flatpickr-day.disabled:hover {
      color: var(--text-secondary) !important;
      border-radius: 50% !important;
      cursor: not-allowed !important;
      opacity: 0.5 !important;
      background: transparent !important;
    }
    .flatpickr-prev-month, .flatpickr-next-month {
      color: white;
      fill: white;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      transition: background 0.2s ease;
    }
    .flatpickr-prev-month:hover, .flatpickr-next-month:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Estilos para el dropdown de sugerencias de email */
    .email-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0 0 var(--radius) var(--radius);
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      display: none;
      margin-top: -1px;
    }
    .email-suggestions div {
      padding: 0.875rem 1rem;
      cursor: pointer;
      transition: background 0.2s ease;
      color: var(--text);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    .email-suggestions div:last-child {
      border-bottom: none;
    }
    .email-suggestions div:hover,
    .email-suggestions div.active {
      background: rgba(76, 40, 130, 0.3);
      color: white;
    }
    .input-wrapper.email-focused .email-suggestions {
      display: block;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="header-hero">
      <h2 id="negocio">Reservar en [Negocio]</h2>
    </div>
    <div class="form-group">
      <label>Nombre</label>
      <div class="input-wrapper">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        <input id="name" placeholder="Tu nombre completo" required />
      </div>
    </div>
    <div class="form-group">
      <label>Email</label>
      <div class="input-wrapper" id="email-wrapper">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
        <input id="email" type="email" placeholder="tu@correo.com" required />
        <div class="email-suggestions" id="email-suggestions"></div>
      </div>
    </div>
    <div class="form-group">
      <label>Tel√©fono</label>
      <div class="input-wrapper">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
        </svg>
        <input id="phone" placeholder="(000) 000-0000" required />
      </div>
    </div>
    <div class="form-group">
      <label>Fecha</label>
      <div class="input-wrapper">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <input id="date" placeholder="Selecciona una fecha" readonly required />
      </div>
    </div>
    <div class="form-group">
      <label>Hora</label>
      <div class="input-wrapper">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12,6 12,12 16,14"></polyline>
        </svg>
        <select id="time" disabled><option value="">Selecciona primero la fecha‚Ä¶</option></select>
      </div>
    </div>
    <button id="btn" disabled>Reservar Cita</button>
    <div id="msg"></div>
    <p class="footer">
      Este sistema de reservas es impulsado por<br>
      <a href="https://www.agenda-connect.com" target="_blank">Agenda Connect</a>
    </p>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    const $ = s => document.querySelector(s);
    const api = 'https://api.agenda-connect.com';
    const params = new URLSearchParams(location.search);
    const slug = params.get('slug');
    if (!slug) {
      $('#msg').textContent = '‚ùå Falta slug';
      $('#btn').disabled = true;
    }
    let cfg = null;
    let diasLaborables = [];

    // Sugerencias de dominios de email
    const emailDomains = [
      '@gmail.com',
      '@hotmail.com',
      '@outlook.com',
      '@yahoo.com',
      '@icloud.com',
      '@protonmail.com',
      '@aol.com',
      '@yahoo.es',
      '@live.com',
      '@me.com',
      '@zoho.com',
      '@yandex.com',
      '@mail.com',
      '@gmx.com'
    ];

    // Variables para el autocomplete de email
    let emailSuggestionsActive = false;
    let selectedIndex = -1;

    // Funci√≥n para mostrar sugerencias
    function showEmailSuggestions(value) {
      const wrapper = $('#email-wrapper');
      const suggestions = $('#email-suggestions');
      const localPart = value.split('@')[0] || '';
      const hasAt = value.includes('@');
      const hasDomain = value.includes('@') && value.split('@')[1].length > 0;

      if (hasAt && !hasDomain) {
        // Mostrar sugerencias completas despu√©s de @
        const filtered = emailDomains.filter(domain => 
          domain.toLowerCase().startsWith('@' + value.split('@')[1].toLowerCase())
        );
        if (filtered.length > 0) {
          suggestions.innerHTML = filtered.map(domain => `<div data-domain="${domain}">${localPart}${domain}</div>`).join('');
          wrapper.classList.add('email-focused');
          emailSuggestionsActive = true;
          selectedIndex = -1;
          return;
        }
      }
      hideEmailSuggestions();
    }

    function hideEmailSuggestions() {
      const wrapper = $('#email-wrapper');
      const suggestions = $('#email-suggestions');
      wrapper.classList.remove('email-focused');
      suggestions.innerHTML = '';
      emailSuggestionsActive = false;
      selectedIndex = -1;
    }

    // Event listeners para email autocomplete
    const emailInput = $('#email');
    emailInput.addEventListener('input', (e) => {
      const value = e.target.value;
      if (value.includes('@')) {
        showEmailSuggestions(value);
      } else {
        hideEmailSuggestions();
      }
    });

    emailInput.addEventListener('keydown', (e) => {
      const suggestions = $('#email-suggestions');
      const items = suggestions.querySelectorAll('div');
      if (!emailSuggestionsActive || items.length === 0) return;

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
        updateSelection(items);
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        selectedIndex = Math.max(selectedIndex - 1, -1);
        updateSelection(items);
      } else if (e.key === 'Enter' && selectedIndex >= 0) {
        e.preventDefault();
        selectSuggestion(items[selectedIndex]);
      } else if (e.key === 'Escape') {
        hideEmailSuggestions();
      }
    });

    function updateSelection(items) {
      items.forEach((item, idx) => {
        item.classList.toggle('active', idx === selectedIndex);
      });
    }

    function selectSuggestion(item) {
      const domain = item.dataset.domain;
      const localPart = emailInput.value.split('@')[0];
      emailInput.value = localPart + domain;
      hideEmailSuggestions();
      emailInput.focus();
    }

    // Click fuera para cerrar sugerencias
    document.addEventListener('click', (e) => {
      if (!emailInput.contains(e.target) && !$('#email-suggestions').contains(e.target)) {
        hideEmailSuggestions();
      }
    });

    // Click en sugerencia
    document.addEventListener('click', (e) => {
      if (e.target.dataset.domain) {
        selectSuggestion(e.target);
      }
    });

    (async () => {
      try {
        const res = await fetch(`${api}/api/public-config/${slug}`);
        cfg = await res.json();
        if (!res.ok || !cfg.nombre) throw new Error(cfg.error || 'Negocio no encontrado');
        $('#negocio').textContent = `Reservar en ${cfg.nombre}`;
        diasLaborables = (cfg.work_days || []).map(d => ({
          Sunday: 0, Monday: 1, Tuesday: 2, Wednesday: 3, Thursday: 4, Friday: 5, Saturday: 6
        }[d])).filter(d => d !== undefined);
        flatpickr("#date", {
          dateFormat: "Y-m-d",
          minDate: "today",
          disable: [
            function(date) {
              return !diasLaborables.includes(date.getDay());
            }
          ],
          locale: {
            firstDayOfWeek: 1,
            weekdays: {
              shorthand: ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'],
              longhand: ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'],
            },
            months: {
              shorthand: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
              longhand: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
            }
          },
          onChange: function(selectedDates, dateStr) {
            if (dateStr) cargarHorasDisponibles(dateStr);
          }
        });
      } catch (err) {
        console.error(err);
        $('#msg').textContent = err.message;
        $('#btn').disabled = true;
      }
    })();

    function formato12h(hora24) {
      let [h, m] = hora24.split(':').map(Number);
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12 || 12;
      return `${h}:${String(m).padStart(2, '0')} ${ampm}`;
    }

    async function cargarHorasDisponibles(fechaISO) {
      $('#time').innerHTML = '<option>Cargando‚Ä¶</option>';
      $('#time').disabled = true;
      $('#msg').textContent = '';
      $('#msg').className = 'loading';
      try {
        const r = await fetch(`${api}/api/available-hours/${slug}?date=${fechaISO}`);
        const { available_hours } = await r.json();
        const hoy = new Date();
        const hoyISO = hoy.toLocaleDateString('en-CA');
        let horasFiltradas = available_hours;
        if (fechaISO === hoyISO) {
          const minutosActuales = hoy.getHours() * 60 + hoy.getMinutes();
          horasFiltradas = available_hours.filter(horaStr => {
            const [h, m] = horaStr.split(':').map(Number);
            return h * 60 + m > minutosActuales;
          });
        }
        if (horasFiltradas.length === 0) {
          $('#time').innerHTML = '<option>No hay horas libres</option>';
          $('#time').disabled = true;
          $('#btn').disabled = true;
          $('#msg').textContent = '‚õî Ya no hay horas disponibles para este d√≠a';
          $('#msg').className = 'error';
          return;
        }
        $('#time').innerHTML = `<option value=""></option>${horasFiltradas.map(h => `<option value="${h}">${formato12h(h)}</option>`).join('')}`;
        $('#time').disabled = false;
        $('#btn').disabled = false;
      } catch (err) {
        console.error('‚ùå Error al cargar horas disponibles:', err);
        $('#time').innerHTML = '<option>Error al cargar</option>';
        $('#time').disabled = true;
        $('#btn').disabled = true;
        $('#msg').textContent = '‚õî Error al cargar las horas';
        $('#msg').className = 'error';
      }
    }

    $('#btn').onclick = async () => {
      const name = $('#name').value.trim();
      const email = $('#email').value.trim();
      const phone = $('#phone').value.trim();
      const date = $('#date').value;
      const time = $('#time').value;
      if (!name || !email || !date || !time) {
        $('#msg').textContent = 'Completa todos los campos';
        $('#msg').className = 'error';
        return;
      }
      $('#btn').disabled = true;
      $('#msg').textContent = 'Enviando‚Ä¶';
      $('#msg').className = 'loading';
      const res = await fetch(`${api}/api/citas/${slug}/crear-cita`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, phone, date, time })
      });
      const json = await res.json();
      $('#btn').disabled = false;
      if (res.ok || res.status === 401) {
        $('#msg').textContent = '‚úÖ Cita creada. Revisa tu correo.';
        $('#msg').className = 'success';
        $('#btn').style.display = 'none';
      } else {
        $('#msg').textContent = '‚õî ' + (json.error || 'No se pudo crear la cita');
        $('#msg').className = 'error';
      }
    };
  </script>
</body>
</html>